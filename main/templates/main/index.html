{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="{% static 'main/css/odoq.css'%}">
    <title>Odoq</title>
</head>
<body>
     <nav class="navbar">
        <div class="help_box"></div>
        <div class="middle_box"></div>
        <div class="plan_box">plan</div>
     </nav>

     
     <div class="main_container">
        <header>
            <div class="header_container">
                One day One question.
                <div class="header_box">
                    Odoq.com
                </div>
            </div>
        </header>
        
        <div class="verticalLine1"></div>
    
        <div class="question_container">
            <div class="question_container_header">
                <p>Season {{season}} #{{code}}</p>
            </div>
            <div class="question_box">
                <img src="{{img.url}}" alt="load Error">
            </div>
        </div>
    
        <div class="verticalLine2"></div>
    
        <div class="answer_container">
            <div class="answer_header">
                Answer.
            </div>
            <div class="answer_input_button_box">
                    <div class="answer_box">
                        <input id="answer_input" type="search" placeholder="정답입력란">
                    </div>
                    <div class="answer_button_box">
                        <button id="answer_button" onClick="answer_post()">
                            enter.
                        </button>
                    </div>
            </div>
        </div>
    
        <div class="verticalLine3"></div>
       
        <footer>
            <div class="aboutUs_container">
                <div class="aboutUs_header">
                    About us.
                </div>
                <div class="aboutUs_content">
                    대치동 수학강사들.
                </div>
            </div>
            <div class="caution_container">
                <div class="caution_header">
                    Caution.
                </div>
                <div class="caution_content">
                    저작권에 보호를 받는 컨텐츠입니다. 출처표시 없이 사용하는 경우
                    법적인 책임을 질 수 있습니다.
                    (지적재산권 최대 5년의 징역/5천만 원의 벌금형에 처할 수 있습니다.)
                    좋은 취지와 의지를 가지고 하는 일인 만큼 저작권 침해에 관해서는
                    엄중하게 대응할 예정입니다.
                    본 컨텐츠가 무단으로 사용되고있는 것을 목격하신 분들은
                    odoq_help@gmail.com으로 꼭 연락 부탁드립니다.
                </div>
            </div>
        </footer>
    </div>
    <script>
        // 정답입력란이 Enter에 반응하도록.
        document.getElementById('answer_input').addEventListener('search', answer_post);

        function debugging(){
            console.log('connected');
        }

        function answer_post(){
            let url = 'answer_post/';
            let req = new XMLHttpRequest();
            req.open('POST', url);
            req.onreadystatechange = function(){
                if(this.readyState == 4 && this.status == 200) {
                    const jsonResponse = JSON.parse(req.responseText);
                    const debugging = jsonResponse['debugging'];
                    console.log(debugging);
                    document.getElementById('answer_input').value = jsonResponse['answer_response'];
                }
            }

            // POST 관련 보안을 위한 Cookie 처리
            function getCookie(name) {
                var cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    var cookies = document.cookie.split(';');
                    for (var i = 0; i < cookies.length; i++) {
                        var cookie = cookies[i].trim();
                        // Does this cookie string begin with the name we want?
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                        }
                    }
                }   
                return cookieValue;
            }

            var csrftoken = getCookie('csrftoken');

            req.setRequestHeader("Content-Type", "application/x-www-form-urlencoded; charset=UTF-8")
            req.setRequestHeader("X-CSRFToken", csrftoken)

            // 보낼 data 양식 맞춰서, send로 보내기.

            var data = "";
            data += 'answer_input='+document.getElementById('answer_input').value;
            req.send(data);
        }
    </script>
</body>
</html>